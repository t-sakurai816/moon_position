<!DOCTYPE html>
<html lang="ja" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>月の方角を表す</title>
  <script type="text/javascript" src="./suncalc.js"></script>

</head>

<body>

  <h1>現在地から月の方向がわかーるテスト</h1>
  <p>テストしてくれると非常にありがたいです。<br>
    文字が見づらくてごめんなさい。ほんとにさっき作ったばかりなんです。</p>
  <p>位置情報を送信したり、製作者が位置情報を取得することはありません。</p>
  <p>月のイラストはだいたいの目安としてご覧ください。</p>
  <p>↓のボタンを押すと位置情報を取得して、月の位置を表示してくれます</p>


  <button onclick="getPosition();">位置情報を取得する</button>

  <br>
  <br>

  <label>現時刻 : </label>
  <span id="view_clock"></span>

  <br>

  <!--緯度を表示-->
  <label>現在地の緯度 : </label>
  <span id="now_latiude"></span>

  <br>

  <!-- 経度を表示 -->
  <label>現在地の経度 : </label>
  <span id="now_longitude"></span>

  <br>

  <!-- 日の入りを表示 -->
  <label>現在の日の入り : </label>
  <span id="now_sunny_in"></span>

  <br>

  <!-- ラジアンを表示 -->
  <label>現在の月までのラジアン : </label>
  <span id="now_moon_position_rad"></span>

  <br>

  <!-- 角度を表示 -->
  <label>現在の角度 : </label>
  <span id="now_degree"></span>

  <br>

  <!-- 方角を表示 -->
  <label>現在の月までの方角 : </label>
  <span id="now_direction"></span>

  <br>

  <!-- 満ち欠けを表示 -->
  <label>現在の月の満ち欠け : </label>
  <span id="now_illumination"></span>
  <br>
  <img id="img_place" src="./koda.jpg" width="104" />

  <br>
  <span id="doeSupported"></sapn>

    <!-- 時刻の表示 -->
    <script type="text/javascript">
      //現時刻を表すスクリプト
      timerID = setInterval('clock()', 500); //0.5秒毎にclock()を実行

      function clock() {
        document.getElementById("view_clock").innerHTML = getNow();
      }

      function getNow() {
        var now = new Date();
        var year = now.getFullYear();
        var mon = now.getMonth() + 1; //１を足すこと
        var day = now.getDate();
        var hour = now.getHours();
        var min = now.getMinutes();
        var sec = now.getSeconds();

        //出力用
        var s = year + "年" + mon + "月" + day + "日" + hour + "時" + min + "分" + sec + "秒";

        return s;
      }
    </script>

    <!-- 月の位置とかのスクリプト -->
    <script>
      // 現在地取得処理
      function getPosition() {
        // 現在地を取得
        navigator.geolocation.getCurrentPosition(
          // 取得成功した場合
          function(position) {

            //緯度を取得
            var latitude = position.coords.latitude;
            document.getElementById("now_latiude").innerHTML = latitude;

            // 経度を取得
            var longitude = position.coords.longitude;
            document.getElementById("now_longitude").innerHTML = longitude;

            // 日の入り
            var sunny_in = SunCalc.getTimes(new Date(), latitude, longitude);
            var tmp_sunny_in = sunny_in.sunset.getHours() + ":" + sunny_in.sunset.getMinutes();
            document.getElementById("now_sunny_in").innerHTML = tmp_sunny_in;


            // ラジアン
            var moon_position_rad = SunCalc.getMoonPosition(new Date(), latitude, longitude);
            var tmp_moon_position_rad = moon_position_rad.azimuth;
            document.getElementById("now_moon_position_rad").innerHTML = tmp_moon_position_rad;

            // 角度
            var degree = moon_position_rad.azimuth * (180 / Math.PI);
            document.getElementById("now_degree").innerHTML = degree;

            // 方角
            var direction = 180 + degree;
            document.getElementById("now_direction").innerHTML = direction;

            //月の満ち欠け
            var illumination = SunCalc.getMoonIllumination(new Date())
            var tmp_illumination = illumination.phase;
            // var tmp_illumination = 0.241;
            document.getElementById("now_illumination").innerHTML = tmp_illumination;


            // 月の画像を表示 if地獄を直したい
            var img = document.getElementById("img_place");
            if (tmp_illumination > 0.875 && tmp_illumination < 1) {
              img.src = "./img/moon_michikake06.png";
            } else if (tmp_illumination > 0.76 && tmp_illumination < 0.875) {
              img.src = "./img/moon_michikake05.png";
            }
            if (tmp_illumination > 0.74 && tmp_illumination < 0.76) { //下弦の月
              img.src = "./img/moon_michikake04.png";
            } else if (tmp_illumination >= 0.625 && tmp_illumination < 0.74) {
              img.src = "./img/moon_michikake03.png";
            } else if (tmp_illumination >= 0.51 && tmp_illumination < 0.625) {
              img.src = "./img/moon_michikake02.png";
            } else if (tmp_illumination >= 0.49 && tmp_illumination < 0.51) { //満月だったら
              img.src = "./img/moon_michikake01.png";
            } else if (tmp_illumination >= 0.375 && tmp_illumination < 0.49) {
              img.src = "./img/moon_michikake12.png";
            } else if (tmp_illumination >= 0.26 && tmp_illumination < 0.375) {
              img.src = "./img/moon_michikake11.png";
            } else if (tmp_illumination >= 0.24 && tmp_illumination < 0.26) { //上限の月
              img.src = "./img/moon_michikake10.png";
            } else if (tmp_illumination >= 0.16 && tmp_illumination < 0.24) {
              img.src = "./img/moon_michikake09.png";
            } else if (tmp_illumination >= 0.08 && tmp_illumination < 0.16) {
              img.src = "./img/moon_michikake08.png";
            } else if (tmp_illumination >= 0 && tmp_illumination < 0.08) { //新月
              img.src = "./img/moon_michikake07.png";
            }

          },
          // 取得失敗した場合
          function(error) {
            switch (error.code) {
              case 1: //PERMISSION_DENIED
                alert("位置情報の利用が許可されていません");
                break;
              case 2: //POSITION_UNAVAILABLE
                alert("現在位置が取得できませんでした");
                break;
              case 3: //TIMEOUT
                alert("タイムアウトになりました");
                break;
              default:
                alert("その他のエラー(エラーコード:" + error.code + ")");
                break;
            }
          }
        );
      }
    </script>


</body>

</html>
